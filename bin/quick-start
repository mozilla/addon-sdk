#! /usr/bin/env python

import sys
import os
import webbrowser
import threading

import cuddlefish
from cuddlefish import server

TASK_RUNNER_PATH = ['packages', 'task-runner']

if __name__ == '__main__':
    args = sys.argv[1:]
    env_root = os.environ['CUDDLEFISH_ROOT']

    thread = threading.Thread(target=server.start,
                              kwargs={'env_root': env_root,
                                      'quiet': True})
    thread.setDaemon(True)
    thread.start()

    webbrowser.open(server.get_url())

    pkgdir = os.path.join(env_root, *TASK_RUNNER_PATH)
    cuddlefish.run(arguments=args+['run'],
                   defaults={'app': 'firefox',
                             'pkgdir': pkgdir})
